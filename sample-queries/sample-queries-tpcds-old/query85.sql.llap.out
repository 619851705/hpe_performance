0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set ambari.hive.db.schema.name=hive;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set fs.file.impl.disable.cache=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set fs.hdfs.impl.disable.cache=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.auto.convert.join.noconditionaltask=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.auto.convert.join=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- set hive.auto.convert.sortmerge.join.noconditionaltask=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.auto.convert.sortmerge.join=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.abortedtxn.threshold=1000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.check.interval=300;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.delta.num.threshold=10;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.delta.pct.threshold=0.1f;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.initiator.on=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.worker.threads=0;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compactor.worker.timeout=86400;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.compute.query.using.stats=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.enforce.bucketing=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.enforce.sorting=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.enforce.sortmergebucketmapjoin=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.limit.pushdown.memory.usage=0.04;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.map.aggr=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.mapjoin.bucket.cache.size=10000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.mapred.reduce.tasks.speculative.execution=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.metastore.cache.pinobjtypes=Table,Database,Type,FieldSchema,Order;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.metastore.client.socket.timeout=60;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.metastore.execute.setugi=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.metastore.warehouse.dir=/apps/hive/warehouse;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.optimize.bucketmapjoin.sortedmerge=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.optimize.bucketmapjoin=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.optimize.index.filter=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- set hive.optimize.mapjoin.mapreduce=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.optimize.reducededuplication.min.reducer=4;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.optimize.reducededuplication=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.orc.splits.include.file.footer=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.security.authorization.enabled=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.security.metastore.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.StorageBasedAuthorizationProvider;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- set hive.semantic.analyzer.factory.impl=org.apache.hivealog.cli.HCatSemanticAnalyzerFactory;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.server2.enable.doAs=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.server2.tez.default.queues=default;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.server2.tez.initialize.default.sessions=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.server2.tez.sessions.per.default.queue=1;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.stats.autogather=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.tez.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DummyTxnManager;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.txn.max.open.batch=1000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.txn.timeout=300;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.vectorized.execution.enabled=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.vectorized.groupby.checkinterval=1024;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.vectorized.groupby.flush.percent=1;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.vectorized.groupby.maxentries=1024;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- These values need to be tuned appropriately to your cluster. These examples are for reference.
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.tez.container.size=6144;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.tez.java.opts=-Xmx5120m;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> --set hive.auto.convert.join.noconditionaltask.size=100000000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> --set hive.auto.convert.join.noconditionaltask.size=320000000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.auto.convert.join.noconditionaltask.size=629145600;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- set hive.auto.convert.join.noconditionaltask.size=720000000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- set hive.auto.convert.join.noconditionaltask.size=1920000000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.execution.engine=tez;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.default.fileformat=orc;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.cbo.enable=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.stats.fetch.column.stats=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.exec.dynamic.partition.mode=nonstrict;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.tez.auto.reducer.parallelism=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> -- set hive.exec.reducers.bytes.per.reducer=1000000000;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.exec.reducers.bytes.per.reducer=67108864;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DummyTxnManager;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.support.concurrency=false;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set hive.tez.exec.print.summary=true;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set tez.grouping.min-size=16777216;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> --set tez.grouping.min-size=8388608;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set tez.grouping.max-size=1073741824;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> --set tez.grouping.max-size=1342177280;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> --set tez.grouping.split-waves=1.7;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> set tez.runtime.io.sort.mb=174;
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> select  substr(r_reason_desc,1,20) as r
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>        ,avg(ws_quantity) wq
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>        ,avg(wr_refunded_cash) ref
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>        ,avg(wr_fee) fee
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>  from web_sales, web_returns, web_page, customer_demographics cd1,
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>       customer_demographics cd2, customer_address, date_dim, reason 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>  where web_sales.ws_web_page_sk = web_page.wp_web_page_sk
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and web_sales.ws_item_sk = web_returns.wr_item_sk
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and web_sales.ws_order_number = web_returns.wr_order_number
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and web_sales.ws_sold_date_sk = date_dim.d_date_sk and d_year = 1998
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and cd1.cd_demo_sk = web_returns.wr_refunded_cdemo_sk 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and cd2.cd_demo_sk = web_returns.wr_returning_cdemo_sk
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and customer_address.ca_address_sk = web_returns.wr_refunded_addr_sk
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and reason.r_reason_sk = web_returns.wr_reason_sk
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_marital_status = 'M'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_marital_status = cd2.cd_marital_status
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_education_status = '4 yr Degree'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_education_status = cd2.cd_education_status
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ws_sales_price between 100.00 and 150.00
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    or
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_marital_status = 'D'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_marital_status = cd2.cd_marital_status
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_education_status = 'Primary' 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_education_status = cd2.cd_education_status
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ws_sales_price between 50.00 and 100.00
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    or
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_marital_status = 'U'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_marital_status = cd2.cd_marital_status
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_education_status = 'Advanced Degree'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      cd1.cd_education_status = cd2.cd_education_status
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ws_sales_price between 150.00 and 200.00
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ca_country = 'United States'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ca_state in ('KY', 'GA', 'NM')
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and ws_net_profit between 100 and 200  
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     or
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ca_country = 'United States'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ca_state in ('MT', 'OR', 'IN')
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and ws_net_profit between 150 and 300  
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     or
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     (
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ca_country = 'United States'
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      ca_state in ('WI', 'MO', 'WV')
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>      and ws_net_profit between 50 and 250  
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>     )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti>    )
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> group by r_reason_desc
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> order by r, wq, ref, fee
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> limit 100;
+-----------------------+---------------------+---------------------+---------------------+--+
|           r           |         wq          |         ref         |         fee         |
+-----------------------+---------------------+---------------------+---------------------+--+
| Did not fit           | 27.807692307692307  | 534.3803849953872   | 54.36346108179826   |
| Did not get it on ti  | 31.678571428571427  | 434.39464470318387  | 49.17892782177244   |
| Did not like the col  | 22.92               | 503.78559410095215  | 46.51680005550384   |
| Did not like the mak  | 29.35483870967742   | 517.6283296902974   | 61.315666341781615  |
| Did not like the mod  | 19.666666666666668  | 562.0533295384159   | 61.26629642204002   |
| Did not like the war  | 22.964285714285715  | 484.86749417441234  | 40.752500287124086  |
| Does not work with a  | 21.636363636363637  | 581.3290928927335   | 52.284999869086526  |
| Found a better exten  | 26.2                | 454.2899930636088   | 42.99000009695689   |
| Found a better price  | 32.15               | 719.41401014328     | 46.7614999294281    |
| Gift exchange         | 27.125              | 406.3637512922287   | 47.97933309872945   |
| Lost my job           | 22.80952380952381   | 460.18523815699984  | 42.02904751187279   |
| No service location   | 28.444444444444443  | 868.1870320991234   | 44.30814806399522   |
| Not the product that  | 20.1                | 413.4183345794678   | 49.04766629536947   |
| Not working any more  | 23.805555555555557  | 361.1877763022979   | 56.06555575794644   |
| Package was damaged   | 19.24137931034483   | 347.83068844367716  | 56.423103135207604  |
| Parts missing         | 20.275862068965516  | 393.76551272951326  | 41.75620691529636   |
| Stopped working       | 24.73076923076923   | 531.0484054565429   | 54.01759986877441   |
| Wrong size            | 34.78378378378378   | 458.7310751257716   | 53.83837810722557   |
| duplicate purchase    | 20.833333333333332  | 637.4272185431587   | 43.55444439252218   |
| it is a girl          | 30.482758620689655  | 1006.6506758065059  | 50.41000012693734   |
| its is a boy          | 22.89189189189189   | 435.7016203854535   | 48.13918925620414   |
| reason 23             | 26.74074074074074   | 590.551108678182    | 60.75740757694951   |
| reason 24             | 38.875              | 768.0770945847034   | 52.97583326200644   |
| reason 25             | 18.884615384615383  | 413.21423172950745  | 39.5880770774988    |
| reason 26             | 26.939393939393938  | 571.200935125351    | 52.62874972820282   |
| reason 27             | 27.608695652173914  | 442.6495709626571   | 36.90347840475      |
| reason 28             | 34.6                | 625.9256682078044   | 36.592333698272704  |
| reason 29             | 28.77777777777778   | 664.7661152945625   | 52.62916681336032   |
| reason 31             | 30.25               | 396.3379581191323   | 47.626363938505     |
| reason 32             | 27.115384615384617  | 470.47807559600244  | 47.623461624750725  |
| reason 33             | 15.91304347826087   | 340.2286913913229   | 50.629565290782764  |
| reason 34             | 25.857142857142858  | 301.5904771259853   | 53.280952294667564  |
| reason 35             | 22.307692307692307  | 377.4646135843717   | 42.14846154818168   |
| reason 36             | 17.583333333333332  | 470.37999788920087  | 44.671666860580444  |
| reason 37             | 19.38888888888889   | 293.99888616138037  | 38.59222202830844   |
| reason 38             | 30.0                | 626.1739150337551   | 48.08130431175232   |
| reason 39             | 24.25               | 529.1887498050928   | 56.94624964892864   |
| reason 40             | 25.14814814814815   | 804.3477784969189   | 64.03925929246125   |
| reason 41             | 18.08108108108108   | 320.7305410939294   | 52.94297302091444   |
| reason 42             | 18.733333333333334  | 578.7413370132447   | 41.43066692352295   |
| reason 43             | 25.5                | 663.8037542700768   | 42.548750042915344  |
| reason 44             | 29.925925925925927  | 558.3003728566347   | 40.60185198430662   |
| reason 45             | 29.37037037037037   | 496.83741201294794  | 56.195185352254796  |
| reason 46             | 31.296296296296298  | 520.166662145544    | 58.23629596056762   |
| reason 47             | 19.78787878787879   | 339.18697021946764  | 48.456363612955265  |
| reason 48             | 23.384615384615383  | 664.6126808386582   | 48.76038449544173   |
| reason 49             | 27.705882352941178  | 688.2658760968377   | 54.393529920017016  |
| reason 50             | 36.73913043478261   | 464.9873932548191   | 45.38782574301181   |
| reason 51             | 28.65625            | 313.4059383124113   | 46.10437512397766   |
| reason 52             | 27.4                | 808.0627877807617   | 47.65199984550476   |
| reason 53             | 23.5                | 432.71307281347424  | 49.253461837768555  |
| reason 54             | 32.90909090909091   | 850.0904471874237   | 51.95863660899076   |
| reason 55             | 32.68               | 915.7031954336167   | 48.80919964790344   |
| reason 56             | 31.526315789473685  | 683.2363224092283   | 46.69473715832359   |
| reason 57             | 25.838709677419356  | 604.8487121212867   | 43.74935501621616   |
| reason 58             | 33.708333333333336  | 449.1275086402893   | 55.85208262503147   |
| reason 59             | 18.333333333333332  | 314.5533338546753   | 44.32566727399826   |
| reason 60             | 24.06451612903226   | 516.5170002937317   | 59.567741947789344  |
| reason 61             | 17.076923076923077  | 374.8111529717079   | 43.69423040518394   |
| reason 62             | 25.166666666666668  | 314.8054168820381   | 53.89208364486694   |
| reason 63             | 28.814814814814813  | 891.72926013558     | 41.983703524978075  |
| reason 64             | 26.17241379310345   | 668.0351659182844   | 49.105172519026134  |
| reason 65             | 19.833333333333332  | 330.28399732907616  | 60.97699901262919   |
| unauthoized purchase  | 23.47826086956522   | 687.4174030967381   | 53.17521761292996   |
+-----------------------+---------------------+---------------------+---------------------+--+
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
0: jdbc:hive2://h01hn02:10500/tpcds_bin_parti> 
